<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ - Registration Details</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            direction: rtl;
        }

        .navbar {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .back-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .back-btn:hover {
            background: white;
            color: #28a745;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }

        .details-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 35px;
            margin-bottom: 20px;
        }

        .details-card h2 {
            color: #1a1a1a;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #28a745;
            font-size: 22px;
        }

        .section-title {
            font-size: 18px;
            color: #495057;
            margin: 30px 0 20px 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: "";
            width: 4px;
            height: 24px;
            background: #28a745;
            border-radius: 2px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .detail-row {
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #6c757d;
            font-size: 13px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .detail-value {
            color: #1a1a1a;
            font-size: 15px;
            font-weight: 500;
        }

        .email-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 35px;
            margin-top: 20px;
        }

        .email-section h2 {
            color: #1a1a1a;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #007bff;
            font-size: 22px;
        }

        .success-message {
            display: none;
            padding: 15px 20px;
            background: #d1e7dd;
            border: 1px solid #badbcc;
            color: #0f5132;
            border-radius: 8px;
            margin-bottom: 20px;
            animation: slideDown 0.3s ease;
        }

        .success-message.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .email-preview {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
            font-size: 14px;
            direction: ltr;
            text-align: left;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .btn-secondary {
            background: #28a745;
            color: white;
        }

        .btn-secondary:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .program-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
        }

        .badge-phd {
            background: #d1e7dd;
            color: #0f5132;
        }

        .badge-masters {
            background: #cfe2ff;
            color: #084298;
        }

        .badge-bachelor {
            background: #fff3cd;
            color: #997404;
        }

        .files-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .file-item-wrapper {
            padding: 15px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .file-item-info {
            flex: 1;
            color: #495057;
            font-size: 14px;
        }

        .file-size {
            color: #6c757d;
            font-size: 12px;
            margin-right: 8px;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .btn-file-action {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-file-action.view {
            background: #007bff;
            color: white;
        }

        .btn-file-action.view:hover {
            background: #0056b3;
        }

        .btn-file-action.download {
            background: #28a745;
            color: white;
        }

        .btn-file-action.download:hover {
            background: #218838;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }

            .container {
                padding: 20px 15px;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .details-card, .email-section {
                padding: 25px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ | Registration Details</h1>
        <a href="admin-dashboard.html" class="back-btn">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Back</a>
    </div>

    <div class="container">
        <div class="details-card">
            <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ | Student Information</h2>
            <div id="detailsContent">
                <p style="text-align: center; color: #6c757d;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„... | Loading...</p>
            </div>
        </div>

        <div class="email-section">
            <h2>ğŸ“§ Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù‚Ø¨ÙˆÙ„ | Generate Admission Email</h2>
            <div class="success-message" id="successMessage">
                âœ“ ØªÙ… Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø±ÙŠØ¯! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù„ØµÙ‚Ù‡ ÙÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø¨Ø±ÙŠØ¯<br>
                Email content copied to clipboard! You can now paste it.
            </div>
            <div class="email-preview" id="emailPreview">
                Generating email template...
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="copyEmail()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø¨Ø±ÙŠØ¯ | Copy Email</button>
                <button class="btn btn-secondary" onclick="openEmailClient()">ğŸ“§ ÙØªØ­ ÙÙŠ Ø§Ù„Ø¨Ø±ÙŠØ¯ | Open Email Client</button>
                <button class="btn btn-danger" onclick="deleteRegistration()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ | Delete</button>
            </div>
        </div>
    </div>

    <script>
        // Check if user is logged in
        if (!sessionStorage.getItem('eduguide_admin_logged_in')) {
            window.location.href = 'admin-login.html';
        }

        let currentRegistration = null;
        let emailContent = '';

        function loadDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = parseInt(urlParams.get('id'));
            
            const registrations = JSON.parse(localStorage.getItem('eduguide_registrations') || '[]');
            currentRegistration = registrations.find(r => r.id === id);
            
            if (!currentRegistration) {
                document.getElementById('detailsContent').innerHTML = '<p style="text-align: center; color: #dc3545;">Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ | Registration not found</p>';
                return;
            }
            
            // Display details
            const date = new Date(currentRegistration.timestamp);
            const formattedDate = date.toLocaleDateString('ar-BH') + ' ' + date.toLocaleTimeString('ar-BH');
            
            // Determine program badge
            let programBadge = '';
            let badgeClass = '';
            if (currentRegistration.programType === 'phd') {
                badgeClass = 'badge-phd';
            } else if (currentRegistration.programType === 'masters') {
                badgeClass = 'badge-masters';
            } else if (currentRegistration.programType === 'bachelor') {
                badgeClass = 'badge-bachelor';
            }
            
            programBadge = `<span class="program-badge ${badgeClass}">${currentRegistration.selectedProgram || currentRegistration.programType}</span>`;
            
            // Build files list with download/view buttons
            let filesList = '';
            const files = [
                { label: 'Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© | CV', key: 'cvFile' },
                { label: 'Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ± | Passport', key: 'passportFile' },
                { label: 'Ø§Ù„Ù‡ÙˆÙŠØ© | ID', key: 'idFile' },
                { label: 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³ | Bachelor', key: 'bachelorFile' },
                { label: 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…Ø§Ø¬Ø³ØªÙŠØ± | Masters', key: 'mastersFile' },
                { label: 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø®Ø¨Ø±Ø© | Experience', key: 'experienceFile' },
                { label: 'Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© | Photo', key: 'photoFile' },
                { label: 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© | High School', key: 'highSchoolFile' }
            ];
            
            files.forEach(file => {
                const fileData = currentRegistration.files ? currentRegistration.files[file.key] : null;
                if (fileData) {
                    filesList += `
                        <div class="file-item-wrapper">
                            <div class="file-item-info">
                                ğŸ“ ${file.label}: <strong>${fileData.name}</strong>
                                <span class="file-size">(${formatFileSize(fileData.size)})</span>
                            </div>
                            <div class="file-actions">
                                <button class="btn-file-action view" onclick="viewFile('${file.key}', ${currentRegistration.id})">ğŸ‘ï¸ Ø¹Ø±Ø¶ | View</button>
                                <button class="btn-file-action download" onclick="downloadFile('${file.key}', ${currentRegistration.id})">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ | Download</button>
                            </div>
                        </div>
                    `;
                }
            });
            
            if (filesList) {
                filesList = `<div class="files-list">${filesList}</div>`;
            } else {
                filesList = '<p style="color: #6c757d;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø±ÙÙ‚Ø© | No files attached</p>';
            }
            
            document.getElementById('detailsContent').innerHTML = `
                <div class="detail-row">
                    <div class="detail-label">Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ | Registration ID</div>
                    <div class="detail-value">#${currentRegistration.id}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„ | Submission Date</div>
                    <div class="detail-value">${formattedDate}</div>
                </div>
                
                <div class="section-title">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© | Personal Information</div>
                <div class="detail-grid">
                    <div class="detail-row">
                        <div class="detail-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ | Full Name</div>
                        <div class="detail-value">${currentRegistration.fullName}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Ø§Ù„Ø¬Ù†Ø³ÙŠØ© | Nationality</div>
                        <div class="detail-value">${currentRegistration.nationality}</div>
                    </div>
                </div>
                
                <div class="section-title">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† | Address</div>
                <div class="detail-grid">
                    <div class="detail-row">
                        <div class="detail-label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© | Area</div>
                        <div class="detail-value">${currentRegistration.address}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ | Street Number</div>
                        <div class="detail-value">${currentRegistration.streetNumber}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø²Ù„ | House Number</div>
                        <div class="detail-value">${currentRegistration.houseNumber}</div>
                    </div>
                </div>
                
                <div class="section-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ | Contact Information</div>
                <div class="detail-grid">
                    <div class="detail-row">
                        <div class="detail-label">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·Ø§Ù„Ø¨ | Student Phone</div>
                        <div class="detail-value">${currentRegistration.studentPhone}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…Ù„ | Work Phone</div>
                        <div class="detail-value">${currentRegistration.workPhone || 'ØºÙŠØ± Ù…ØªÙˆÙØ± | N/A'}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ | Email</div>
                        <div class="detail-value">${currentRegistration.email}</div>
                    </div>
                </div>
                
                <div class="section-title">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…Ø®ØªØ§Ø± | Selected Program</div>
                <div class="detail-row">
                    <div class="detail-label">Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ | Program Type</div>
                    <div class="detail-value">${programBadge}</div>
                </div>
                
                <div class="section-title">Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø±ÙÙ‚Ø© | Attached Documents</div>
                ${filesList}
                
                ${currentRegistration.notes ? `
                    <div class="section-title">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© | Additional Notes</div>
                    <div class="detail-row">
                        <div class="detail-value">${currentRegistration.notes}</div>
                    </div>
                ` : ''}
            `;
            
            // Generate email template
            generateEmailTemplate();
        }

        function generateEmailTemplate() {
            emailContent = `Subject: Student Admission Request - ${currentRegistration.fullName}

Dear Admissions Team,

Please find below the details of the student who wishes to enroll at your university. Should you require any additional information, please let us know.

Student Name:
${currentRegistration.fullName}

Major:
${currentRegistration.selectedProgram || currentRegistration.programType}

Phone Number:
${currentRegistration.studentPhone}

Email Address:
${currentRegistration.email}

Nationality:
${currentRegistration.nationality}

We want to confirm that the student has been informed about the university fees and major, and that the student has agreed.

As a next step, please get in touch with the student and inform them of their acceptance, gather all necessary information, and send them the registration fees for payment.

Thank you for your cooperation.

--
Regards

ALI ABDULHADI | Regional Admissions Manager
E: ar@eduguidebh.com
www.eduguidebh.com

EduGuide Educational Support, Bahrain CR-183368
Office 13, 644 Street, 406 Sanabis, Bahrain.`;

            document.getElementById('emailPreview').textContent = emailContent;
        }

        function copyEmail() {
            navigator.clipboard.writeText(emailContent).then(() => {
                document.getElementById('successMessage').classList.add('show');
                setTimeout(() => {
                    document.getElementById('successMessage').classList.remove('show');
                }, 3000);
            }).catch(err => {
                alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠØ§Ù‹ | Failed to copy. Please copy manually.');
            });
        }

        function openEmailClient() {
            const subject = encodeURIComponent(`Student Admission Request - ${currentRegistration.fullName}`);
            const body = encodeURIComponent(emailContent.split('\n').slice(2).join('\n'));
            
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        function deleteRegistration() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡\n\nAre you sure you want to delete this registration? This action cannot be undone.')) {
                return;
            }
            
            let registrations = JSON.parse(localStorage.getItem('eduguide_registrations') || '[]');
            registrations = registrations.filter(r => r.id !== currentRegistration.id);
            localStorage.setItem('eduguide_registrations', JSON.stringify(registrations));
            
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ | Registration deleted successfully');
            window.location.href = 'admin-dashboard.html';
        }

        // Load details on page load
        loadDetails();

        // Check if we need to auto-copy email
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('action') === 'email') {
            setTimeout(() => {
                copyEmail();
            }, 500);
        }

        // Helper function to format file size
        function formatFileSize(bytes) {
            if (!bytes) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
        }

        // View file in new tab
        function viewFile(fileKey, registrationId) {
            const registrations = JSON.parse(localStorage.getItem('eduguide_registrations') || '[]');
            const registration = registrations.find(r => r.id === registrationId);
            
            if (!registration || !registration.files || !registration.files[fileKey]) {
                alert('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ | File not found');
                return;
            }
            
            const fileData = registration.files[fileKey];
            
            // Open file in new window
            const newWindow = window.open();
            if (fileData.type.startsWith('image/')) {
                newWindow.document.write(`
                    <html>
                        <head>
                            <title>${fileData.name}</title>
                            <style>
                                body { margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #000; }
                                img { max-width: 100%; max-height: 100vh; }
                            </style>
                        </head>
                        <body>
                            <img src="${fileData.data}" alt="${fileData.name}">
                        </body>
                    </html>
                `);
            } else if (fileData.type === 'application/pdf') {
                newWindow.document.write(`
                    <html>
                        <head>
                            <title>${fileData.name}</title>
                            <style>
                                body { margin: 0; }
                                iframe { width: 100%; height: 100vh; border: none; }
                            </style>
                        </head>
                        <body>
                            <iframe src="${fileData.data}"></iframe>
                        </body>
                    </html>
                `);
            } else {
                // For other file types, trigger download
                downloadFile(fileKey, registrationId);
            }
        }

        // Download file
        function downloadFile(fileKey, registrationId) {
            const registrations = JSON.parse(localStorage.getItem('eduguide_registrations') || '[]');
            const registration = registrations.find(r => r.id === registrationId);
            
            if (!registration || !registration.files || !registration.files[fileKey]) {
                alert('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ | File not found');
                return;
            }
            
            const fileData = registration.files[fileKey];
            
            // Create download link
            const link = document.createElement('a');
            link.href = fileData.data;
            link.download = fileData.name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>